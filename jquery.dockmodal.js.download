(function(f){var g={width:400,height:"65%",minimizedWidth:200,gutter:10,poppedOutDistance:"6%",title:"",dialogClass:"",buttons:[],animationSpeed:400,opacity:1,initialState:"modal",showClose:true,showPopout:true,showMinimize:true,create:undefined,open:undefined,beforeClose:undefined,close:undefined,beforeMinimize:undefined,minimize:undefined,beforeRestore:undefined,restore:undefined,beforePopout:undefined,popout:undefined};var c="dockmodal";var e=f(window).width();function d(j,h){var i=j.options.animationSpeed/1000;h.css({transition:i+"s right, "+i+"s left, "+i+"s top, "+i+"s bottom, "+i+"s height, "+i+"s width"});return true}function b(h){h.css({transition:"none"});return true}var a={init:function(h){return this.each(function(){var p=f(this);var l=p.data("dockmodal");p.options=f.extend({},g,h);if(!l){p.data("dockmodal",p)}else{f("body").append(p.closest("."+c).show());a.refreshLayout();setTimeout(function(){a.restore.apply(p)},p.options.animationSpeed);return}var k=f("body");var i=f(window);var j=f("<div/>").addClass(c).addClass(p.options.dialogClass);if(p.options.initialState=="modal"){j.addClass("popped-out")}else{if(p.options.initialState=="minimized"){j.addClass("minimized")}}j.height(0);d(p,j);var m=f("<div></div>").addClass(c+"-header");if(p.options.showClose){f('<a href="#" class="header-action action-close" title="Close"><i class="icon-dockmodal-close"></i></a>').appendTo(m).click(function(t){a.destroy.apply(p);return false})}if(p.options.showPopout){f('<a href="#" class="header-action action-popout" title="Pop out"><i class="icon-dockmodal-popout"></i></a>').appendTo(m).click(function(t){if(j.hasClass("popped-out")){a.restore.apply(p)}else{a.popout.apply(p)}return false})}if(p.options.showMinimize){f('<a href="#" class="header-action action-minimize" title="Minimize"><i class="icon-dockmodal-minimize"></i></a>').appendTo(m).click(function(t){if(j.hasClass("minimized")){if(j.hasClass("popped-out")){a.popout.apply(p)}else{a.restore.apply(p)}}else{a.minimize.apply(p)}return false})}if(p.options.showMinimize&&p.options.showPopout){m.click(function(){if(j.hasClass("minimized")){if(j.hasClass("popped-out")){a.popout.apply(p)}else{a.restore.apply(p)}}else{a.minimize.apply(p)}return false})}else{m.click(function(){if(j.hasClass("minimized")){a.popout.apply(p)}else{a.minimize.apply(p)}return false})}m.append('<div class="title-text">'+(p.options.title||p.attr("title"))+"</div>");j.append(m);var o=f('<div class="modal-placeholder"></div>').insertAfter(p);p.placeholder=o;var s=f("<div></div>").addClass(c+"-body").append(p);j.append(s);if(p.options.buttons.length){var q=f("<div></div>").addClass(c+"-footer");var n=f("<div></div>").addClass(c+"-footer-buttonset");q.append(n);f.each(p.options.buttons,function(v,t){var u=f('<a href="#" class="btn"></a>');u.attr({id:t.id,"class":t.buttonClass});u.html(t.html);u.click(function(w){t.click(w,p);return false});n.append(u)});j.append(q)}else{j.addClass("no-footer")}var r=f("."+c+"-overlay");if(!r.length){r=f("<div/>").addClass(c+"-overlay")}if(f.isFunction(p.options.create)){p.options.create(p)}k.append(j);j.after(r);s.focus();if(f.isFunction(p.options.open)){setTimeout(function(){p.options.open(p)},p.options.animationSpeed)}if(j.hasClass("minimized")){j.find(".dockmodal-body, .dockmodal-footer").hide();a.minimize.apply(p)}else{if(j.hasClass("popped-out")){a.popout.apply(p)}else{a.restore.apply(p)}}k.data("windowWidth",i.width());i.unbind("resize.dockmodal").bind("resize.dockmodal",function(){if(i.width()==k.data("windowWidth")){return}k.data("windowWidth",i.width());a.refreshLayout()})})},destroy:function(){return this.each(function(){var j=f(this).data("dockmodal");if(!j){return}if(f.isFunction(j.options.beforeClose)){if(j.options.beforeClose(j)===false){return}}try{var i=j.closest("."+c);if(i.hasClass("popped-out")&&!i.hasClass("minimized")){i.css({left:"50%",right:"50%",top:"50%",bottom:"50%"})}else{i.css({width:"0",height:"0"})}setTimeout(function(){j.removeData("dockmodal");j.placeholder.replaceWith(j);i.remove();f("."+c+"-overlay").hide();a.refreshLayout();if(f.isFunction(j.options.close)){j.options.close(j)}},j.options.animationSpeed)}catch(h){alert(h.message)}})},close:function(){a.destroy.apply(this)},minimize:function(){return this.each(function(){var j=f(this).data("dockmodal");if(!j){return}if(f.isFunction(j.options.beforeMinimize)){if(j.options.beforeMinimize(j)===false){return}}var i=j.closest("."+c);var h=i.find(".dockmodal-header").outerHeight();i.addClass("minimized").css({width:j.options.minimizedWidth+"px",height:h+"px",left:"auto",right:"auto",top:"auto",bottom:"0"});setTimeout(function(){i.find(".dockmodal-body, .dockmodal-footer").hide();if(f.isFunction(j.options.minimize)){j.options.minimize(j)}},j.options.animationSpeed);f("."+c+"-overlay").hide();i.find(".action-minimize").attr("title","Restore");a.refreshLayout()})},restore:function(){return this.each(function(){var i=f(this).data("dockmodal");if(!i){return}if(f.isFunction(i.options.beforeRestore)){if(i.options.beforeRestore(i)===false){return}}var h=i.closest("."+c);h.removeClass("minimized popped-out");h.find(".dockmodal-body, .dockmodal-footer").show();h.css({width:i.options.width+"px",height:i.options.height,left:"auto",right:"auto",top:"auto",bottom:"0"});f("."+c+"-overlay").hide();h.find(".action-minimize").attr("title","Minimize");h.find(".action-popout").attr("title","Pop-out");setTimeout(function(){if(f.isFunction(i.options.restore)){i.options.restore(i)}},i.options.animationSpeed);a.refreshLayout()})},popout:function(){return this.each(function(){var j=f(this).data("dockmodal");if(!j){return}if(f.isFunction(j.options.beforePopout)){if(j.options.beforePopout(j)===false){return}}var i=j.closest("."+c);i.find(".dockmodal-body, .dockmodal-footer").show();b(i);var k=i.position();var h=f(window).width();i.css({width:"auto",height:"auto",left:k.left+"px",right:(h-k.left-i.outerWidth(true))+"px",top:k.top+"px",bottom:0});d(j,i);setTimeout(function(){i.removeClass("minimized").addClass("popped-out").css({width:"auto",height:"auto",left:j.options.poppedOutDistance,right:j.options.poppedOutDistance,top:"50px",bottom:j.options.poppedOutDistance});f("."+c+"-overlay").show();i.find(".action-popout").attr("title","Pop-in");a.refreshLayout()},10);setTimeout(function(){if(f.isFunction(j.options.popout)){j.options.popout(j)}},j.options.animationSpeed)})},refreshLayout:function(){var i=0;var h=f(window).width();f.each(f("."+c).toArray().reverse(),function(j,m){var k=f(this);var l=k.find("."+c+"-body > div").data("dockmodal");if(k.hasClass("popped-out")&&!k.hasClass("minimized")){return}i+=l.options.gutter;k.css({right:i+"px"});if(k.hasClass("minimized")){i+=l.options.minimizedWidth}else{i+=l.options.width}if(i>h){k.hide()}else{setTimeout(function(){k.show()},l.options.animationSpeed)}})}};f.fn.dockmodal=function(h){if(a[h]){return a[h].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof h==="object"||!h){return a.init.apply(this,arguments)}else{f.error("Method "+h+" does not exist on jQuery.dockmodal")}}}})(jQuery);